rm={},rm.rightClickMode="custom",rm.toggleRightClickMode=function(){"custom"===rm.rightClickMode?(rm.rightClickMode="default",window.oncontextmenu=null,anzhiyu.snackbarShow("已切换为浏览器默认右键")):(rm.rightClickMode="custom",window.oncontextmenu=oncontextmenuFunction,anzhiyu.snackbarShow("已切换为网站自定义右键"));const e=document.getElementById("rightclick-toggle");e&&("custom"===rm.rightClickMode?e.classList.add("on"):e.classList.remove("on"))};let aElements=document.getElementsByTagName("a");for(let e=0;e<aElements.length;e++){aElements[e].setAttribute("draggable","false");let t=aElements[e].getElementsByTagName("img");for(let e=0;e<t.length;e++)t[e].setAttribute("draggable","false")}rm.showRightMenu=function(e,t=0,n=0){console.info(t,n);let i=document.getElementById("rightMenu");i.style.top=t+"px",i.style.left=n+"px",e?(i.style.display="block",stopMaskScroll()):i.style.display="none"},rm.hideRightMenu=function(){rm.showRightMenu(!1),document.querySelector("#rightmenu-mask").style.display="none"};let rmWidth=document.getElementById("rightMenu").offsetWidth,rmHeight=document.getElementById("rightMenu").offsetHeight;rm.reloadrmSize=function(){rightMenu.style.visibility="hidden",rightMenu.style.display="block",rmWidth=document.getElementById("rightMenu").offsetWidth,rmHeight=document.getElementById("rightMenu").offsetHeight,rightMenu.style.visibility="visible"};let domhref="",domImgSrc="",globalEvent=null;var oncontextmenuFunction=function(e){if(document.body.clientWidth>768){let t=e.clientX+10,n=e.clientY;const i=document.querySelector(".rightMenuOther"),o=document.querySelector(".rightMenuPlugin"),c=document.querySelector("#menu-copytext"),l=document.querySelector("#menu-pastetext"),d=document.querySelector("#menu-commenttext"),m=document.querySelector("#menu-newwindow"),s=document.querySelector("#menu-newwindowimg"),r=document.querySelector("#menu-copylink"),u=document.querySelector("#menu-copyimg"),a=document.querySelector("#menu-downloadimg"),g=document.querySelector("#menu-search"),y=document.querySelector("#menu-searchBaidu"),h=document.querySelector("#menu-music-toggle"),p=document.querySelector("#menu-music-mode"),w=document.querySelector("#menu-music-back"),f=document.querySelector("#menu-music-forward"),E=document.querySelector("#menu-music-playlist"),k=document.querySelector("#menu-music-copyMusicName"),v=document.querySelector("#menu-music-songlist");let b=e.target.href,S=e.target.currentSrc,I=!1;i.style.display="block",globalEvent=e,selectTextNow&&window.getSelection()?(I=!0,c.style.display="block",d.style.display="block",g.style.display="block",y.style.display="block"):(c.style.display="none",d.style.display="none",y.style.display="none",g.style.display="none"),b?(I=!0,m.style.display="block",r.style.display="block",domhref=b):(m.style.display="none",r.style.display="none"),S?(I=!0,u.style.display="block",a.style.display="block",s.style.display="block",document.getElementById("rightMenu").style.width="12rem",domImgSrc=S):(u.style.display="none",a.style.display="none",s.style.display="none"),"input"===e.target.tagName.toLowerCase()||"textarea"===e.target.tagName.toLowerCase()?(I=!0,l.style.display="block"):l.style.display="none";const B=document.querySelector("#nav-music");return B&&B.contains(e.target)?(I=!0,h.style.display="block",p.style.display="block",w.style.display="block",f.style.display="block",E.style.display="block",k.style.display="block",v.style.display="block",rm.generateSongList()):(h.style.display="none",p.style.display="none",w.style.display="none",f.style.display="none",E.style.display="none",k.style.display="none",v.style.display="none"),I?(i.style.display="none",o.style.display="block"):o.style.display="none",rm.reloadrmSize(),t+rmWidth>window.innerWidth&&(t-=rmWidth+10),n+rmHeight>window.innerHeight&&(n-=n+rmHeight-window.innerHeight),rm.showRightMenu(!0,n,t),document.getElementById("rightmenu-mask").style.display="flex",!1}};function imageToBlob(e){const t=new Image,n=document.createElement("canvas"),i=n.getContext("2d");return t.crossOrigin="",t.src=e,new Promise(e=>{t.onload=function(){n.width=this.naturalWidth,n.height=this.naturalHeight,i.drawImage(this,0,0),n.toBlob(t=>{e(t)},"image/png",.75)}})}async function copyImage(e){const t=await imageToBlob(e),n=new ClipboardItem({"image/png":t});navigator.clipboard.write([n])}function stopMaskScroll(){document.getElementById("rightmenu-mask")&&document.getElementById("rightmenu-mask").addEventListener("mousewheel",function(e){const t=document.querySelector(".rightMenu-submenu");t&&t.contains(e.target)||rm.hideRightMenu()},{passive:!0}),document.getElementById("rightMenu")&&document.getElementById("rightMenu").addEventListener("mousewheel",function(e){const t=document.querySelector(".rightMenu-submenu");t&&t.contains(e.target)||rm.hideRightMenu()},{passive:!0})}window.oncontextmenu=oncontextmenuFunction,rm.downloadimging=!1,rm.writeClipImg=function(e){console.log("按下复制"),rm.hideRightMenu(),anzhiyu.snackbarShow("正在下载中，请稍后",!1,1e4),0==rm.downloadimging&&(rm.downloadimging=!0,setTimeout(function(){copyImage(e),anzhiyu.snackbarShow("复制成功！图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1},"10000"))},rm.copyUrl=function(e){const t=document.createElement("input");t.id="copyVal",document.body.appendChild(t);const n=e;t.value=n,t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),t.remove()},rm.rightmenuCopyText=function(e){navigator.clipboard&&navigator.clipboard.writeText(e),rm.hideRightMenu()},rm.copyPageUrl=function(e){e||(e=window.location.href),rm.copyUrl(e),anzhiyu.snackbarShow("复制链接地址成功",!1,2e3),rm.hideRightMenu()};var selectTextNow="";function selceText(){var e;e=document.selection?document.selection.createRange().text:window.getSelection().toString(),selectTextNow=""!==e?e:""}function replaceAll(e,t,n){return e.split(t).join(n)}function addRightMenuClickEvent(){document.getElementById("menu-backward").addEventListener("click",function(){window.history.back(),rm.hideRightMenu()}),document.getElementById("menu-forward").addEventListener("click",function(){window.history.forward(),rm.hideRightMenu()}),document.getElementById("menu-refresh").addEventListener("click",function(){window.location.reload()}),document.getElementById("menu-top").addEventListener("click",function(){anzhiyu.scrollToDest(0,500),rm.hideRightMenu()}),document.getElementById("menu-translate").addEventListener("click",function(){window.translateFn.translatePage(),rm.hideRightMenu()}),document.querySelectorAll(".menu-link").forEach(function(e){e.addEventListener("click",rm.hideRightMenu)}),document.getElementById("menu-home")&&document.getElementById("menu-home").addEventListener("click",function(){window.location.href=window.location.origin}),document.getElementById("menu-randomPost").addEventListener("click",function(){toRandomPost()}),document.getElementById("menu-commentBarrage").addEventListener("click",anzhiyu.switchCommentBarrage),document.getElementById("rightmenu-mask").addEventListener("click",rm.hideRightMenu),document.getElementById("rightmenu-mask").addEventListener("contextmenu",function(e){rm.hideRightMenu(),e.preventDefault()}),document.getElementById("menu-copy").addEventListener("click",()=>{rm.copyPageUrl()}),document.getElementById("menu-pastetext").addEventListener("click",rm.pasteText),document.getElementById("menu-copytext").addEventListener("click",function(){rm.rightmenuCopyText(selectTextNow);const e=GLOBAL_CONFIG.copyright;e.copy&&anzhiyu.snackbarShow(e.languages.copySuccess)}),document.getElementById("menu-commenttext").addEventListener("click",function(){rm.rightMenuCommentText(selectTextNow)}),document.getElementById("menu-newwindow").addEventListener("click",function(){window.open(domhref,"_blank"),rm.hideRightMenu()}),document.getElementById("menu-copylink").addEventListener("click",rm.copyLink),document.getElementById("menu-downloadimg").addEventListener("click",function(){anzhiyu.downloadImage(domImgSrc,"aurorp1g")}),document.getElementById("menu-newwindowimg").addEventListener("click",function(){window.open(domImgSrc,"_blank"),rm.hideRightMenu()}),document.getElementById("menu-copyimg").addEventListener("click",function(){rm.writeClipImg(domImgSrc)}),document.getElementById("menu-searchBaidu").addEventListener("click",rm.searchBaidu),document.getElementById("menu-music-toggle").addEventListener("click",anzhiyu.musicToggle),document.getElementById("menu-music-mode").addEventListener("click",anzhiyu.musicToggleLoop),document.getElementById("menu-music-back").addEventListener("click",anzhiyu.musicSkipBack),document.getElementById("menu-music-forward").addEventListener("click",anzhiyu.musicSkipForward),document.getElementById("menu-music-copyMusicName").addEventListener("click",function(){rm.rightmenuCopyText(anzhiyu.musicGetName()),anzhiyu.snackbarShow("复制歌曲名称成功",!1,3e3)})}document.onmouseup=document.ondblclick=selceText,rm.readClipboard=function(){navigator.clipboard&&navigator.clipboard.readText().then(e=>rm.insertAtCaret(globalEvent.target,e))},rm.insertAtCaret=function(e,t){const n=e.selectionStart,i=e.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(n||"0"==n){var o=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(i,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=o}else e.value+=t,e.focus()},rm.pasteText=function(){rm.readClipboard(),rm.hideRightMenu()},rm.rightMenuCommentText=function(e){rm.hideRightMenu();var t=document.getElementById("post-comment").offsetTop;window.scrollTo(0,t-80),"undefined"!=e&&"null"!=e||(e="好棒！"),function t(){setTimeout(()=>{var n=document.getElementsByClassName("el-textarea__inner")[0];n||t();let i=document.createEvent("HTMLEvents");i.initEvent("input",!0,!0);let o=replaceAll(e,"\n","\n> ");n.value="> "+o+"\n\n",n.dispatchEvent(i),n.focus(),n.setSelectionRange(-1,-1),document.getElementById("comment-tips")&&document.getElementById("comment-tips").classList.add("show")},100)}()},rm.searchBaidu=function(){anzhiyu.snackbarShow("即将跳转到百度搜索",!1,2e3),setTimeout(function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)},"2000"),rm.hideRightMenu()},rm.copyLink=function(){rm.rightmenuCopyText(domhref),anzhiyu.snackbarShow("已复制链接地址")},rm.generateSongList=async function(){const e=document.getElementById("menu-music-songlist-submenu");if(!e)return;e.innerHTML="";const t=()=>{const e=document.getElementById("rightMenu"),t=document.getElementById("menu-music-songlist-submenu");if(!e||!t)return;const n=e.getBoundingClientRect(),i=window.innerWidth;n.right+250>i?(t.style.left="auto",t.style.right="100%"):(t.style.left="100%",t.style.right="auto")};t(),window.addEventListener("resize",t);let n=[],i=0;const o=document.getElementById("nav-music");if(o){const e=o.querySelector("meting-js");if(e&&e.aplayer){const t=e.aplayer;n=t.list.audios||[],i=t.list.index||0}}if(0===n.length)try{window.musicList&&window.musicList.length>0&&(n=window.musicList)}catch(e){console.warn("无法获取歌曲数据:",e)}if(0===n.length)try{const e=await fetch("/json/music.json");e.ok&&(n=await e.json())}catch(e){console.warn("直接获取music.json失败:",e)}if(0===n.length){const t=document.createElement("div");return t.className="rightMenu-submenu-item",t.textContent="暂无歌曲",t.style.color="#999",t.style.cursor="default",void e.appendChild(t)}n.forEach((t,n)=>{const o=document.createElement("div");o.className="rightMenu-submenu-item",o.innerHTML=`\n      <div style="display: flex; align-items: center; width: 100%;">\n        <div style="min-width: 20px; text-align: center; font-size: 0.85rem; opacity: 0.7; margin-right: 8px;">\n          ${(n+1).toString().padStart(2,"0")}\n        </div>\n        <div style="flex: 1; min-width: 0;">\n          <div style="font-weight: 600; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">\n            ${t.name}\n          </div>\n          <div style="font-size: 0.8rem; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">\n            ${t.artist}\n          </div>\n        </div>\n      </div>\n    `,o.setAttribute("data-index",n),n===i&&o.classList.add("current-song"),o.addEventListener("click",function(e){e.stopPropagation(),rm.playSongAtIndex(n)}),e.appendChild(o)})},rm.playSongAtIndex=function(e){const t=document.getElementById("nav-music");if(t){const n=t.querySelector("meting-js");if(n&&n.aplayer){const t=n.aplayer;t.list.switch(e),t.audio.paused&&t.play(),anzhiyu.snackbarShow(`正在播放: ${t.list.audios[e].name}`,!1,3e3)}else anzhiyu.snackbarShow("播放器未初始化",!1,2e3)}else anzhiyu.snackbarShow("未找到音乐播放器",!1,2e3);rm.hideRightMenu()},addRightMenuClickEvent();