<html lang="zh-CN"><head><meta charset="UTF-8"><title>交互式3D粒子圣诞树</title><style>body{margin:0;height:100vh;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#161616;color:#fff}.message{position:fixed;left:60px;top:50%;transform:translateY(-50%);color:#fff;font-family:'Brush Script MT',cursive;text-align:left;text-shadow:0 0 15px rgba(255,255,255,.6),0 0 30px rgba(255,255,255,.4),0 0 45px rgba(255,255,255,.2);pointer-events:none;z-index:1000;transition:transform .3s ease-out}.message h1{font-size:52px;margin:0;opacity:0;animation:fadeInLeft 2s ease-out forwards;letter-spacing:2px}.message p{font-size:28px;margin:20px 0;opacity:0;animation:fadeInLeft 2s ease-out 1s forwards}@keyframes fadeInLeft{from{opacity:0;transform:translateX(-40px) scale(.8)}to{opacity:1;transform:translateX(0) scale(1)}}.subtitle{position:fixed;right:60px;bottom:50px;color:#fff;font-family:'Dancing Script',cursive;text-align:right;text-shadow:0 0 15px rgba(255,255,255,.6),0 0 30px rgba(255,255,255,.4),0 0 45px rgba(255,255,255,.2);pointer-events:auto;z-index:1000}.subtitle p{font-size:26px;margin:0;opacity:0;animation:fadeIn 2s ease-out 1.5s forwards}@keyframes fadeIn{from{opacity:0;transform:translateX(40px) scale(.8)}to{opacity:1;transform:translateX(0) scale(1)}}#musicButton{position:fixed;top:20px;right:20px;background:#fff;color:#161616;border:none;padding:10px 15px;border-radius:5px;cursor:pointer;font-family:Arial,sans-serif;font-weight:700;z-index:1001;box-shadow:0 0 15px rgba(255,255,255,.6)}.dg.main .close-button{display:none}</style></head><body><button id="musicButton">播放音乐</button><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/build/three.min.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/postprocessing/EffectComposer.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/postprocessing/RenderPass.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/postprocessing/ShaderPass.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/shaders/CopyShader.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/shaders/LuminosityHighPassShader.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/postprocessing/UnrealBloomPass.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/controls/OrbitControls.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script><script>const{PI:PI,sin:sin,cos:cos}=Math,TAU=2*PI,map=(e,t,n,o,a)=>o+(e-t)/(n-t)*(a-o),rand=(e,t=0)=>t+Math.random()*(e-t),randChoise=e=>e[Math.floor(Math.random()*e.length)],polar=(e,t=1)=>[t*cos(e),t*sin(e)];let scene,camera,renderer,step=0;const uniforms={time:{type:"f",value:0},step:{type:"f",value:0}},params={exposure:1,bloomStrength:1.5,bloomThreshold:0,bloomRadius:.7,isDecorationsDancing:!1,isTreeGreen:!1};let composer;const totalPoints=4e3;let treePoints,groundPoints,controls,gui,musicPlayer,musicPlaying=!1;function init(){scene=new THREE.Scene,renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e3),camera.position.set(0,0,50),camera.rotation.set(0,0,0),scene.position.x=0,scene.position.z=1,controls=new THREE.OrbitControls(camera,renderer.domElement),controls.autoRotate=!0,controls.autoRotateSpeed=.5,controls.enableDamping=!0,controls.dampingFactor=.05,controls.minDistance=20,controls.maxDistance=100,controls.target.set(0,5,0),controls.update(),addTree(scene,uniforms,4e3,[0,0,0]),addDecorations(scene,uniforms,150),addSnow(scene,uniforms,600),addPlane(scene,uniforms,3e3);const e=new THREE.RenderPass(scene,camera),t=new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1.8,.35,.85);t.threshold=params.bloomThreshold,t.strength=params.bloomStrength,t.radius=params.bloomRadius,composer=new THREE.EffectComposer(renderer),composer.addPass(e),composer.addPass(t),setupMusic(),setupGUI(t),window.addEventListener("resize",onWindowResize,!1);const n=document.createElement("div");n.id="fullscreenOverlay",n.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(22, 22, 22, 0.9);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 9999;\n                cursor: pointer;\n                transition: opacity 0.5s ease-out;\n            ",n.innerHTML='\n                <div style="text-align: center; color: white; font-family: Arial, sans-serif;">\n                    <h2 style="font-size: 32px; margin-bottom: 20px; text-shadow: 0 0 15px rgba(255,255,255,0.6);">\n                        点击屏幕进入全屏模式\n                    </h2>\n                    <p style="font-size: 18px; opacity: 0.8;">按 ESC 键退出全屏</p>\n                    <p style="font-size: 14px; margin-top: 30px; opacity: 0.6;">体验沉浸式3D圣诞树</p>\n                </div>\n            ',document.body.appendChild(n),n.addEventListener("click",async()=>{!function(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}(),n.style.opacity="0",setTimeout(()=>{n.style.display="none"},500),scene.userData.audioLoaded?await startStopMusic():console.log("音频还在加载中，稍后可手动点击播放")},{once:!0})}function setupGUI(e){gui=new dat.GUI,gui.closed=!0;const t=gui.addFolder("辉光 (Bloom)");t.add(params,"bloomStrength",0,3).name("强度").onChange(t=>{e.strength=t}),t.add(params,"bloomRadius",0,2).name("半径").onChange(t=>{e.radius=t}),t.add(params,"bloomThreshold",0,1).name("阈值").onChange(t=>{e.threshold=t});const n=gui.addFolder("圣诞树 (Tree)");n.add(params,"isTreeGreen").name("切换绿色").onChange(e=>{toggleTreeColor(e)}),n.add(params,"isDecorationsDancing").name("装饰物跳舞"),n.add({changeColor:()=>toggleTreeColor(!1,!0)},"changeColor").name("切换红色");const o=gui.addFolder("控制 (Controls)");o.add(controls,"autoRotate").name("自动旋转"),o.add(controls,"autoRotateSpeed",.1,2).name("旋转速度"),t.open(),n.open()}function toggleTreeColor(e,t=!1){const n=treePoints.geometry,o=n.attributes.color.array,a=new THREE.Color;for(let n=0;n<o.length;n+=3){const r=n/o.length;if(t)r>.1&&(a.setHSL(0,.8,.5),o[n]=a.r,o[n+1]=a.g,o[n+2]=a.b);else if(e){if(r<.1)a.setHSL(.15,.8,.5);else{const e=map(r,.1,1,.85,.95);a.setHSL(.3,.9,e)}o[n]=a.r,o[n+1]=a.g,o[n+2]=a.b}else{if(r<.1)a.setHSL(0,0,.7);else{const e=map(r,.1,1,.7,.9);a.setHSL(0,0,e)}o[n]=a.r,o[n+1]=a.g,o[n+2]=a.b}}n.attributes.color.needsUpdate=!0}function setupMusic(){const e=new Audio("https://cdn.pixabay.com/download/audio/2025/06/13/audio_d5fa62b5af.mp3?filename=jingle-bells-348411.mp3");e.loop=!0,e.volume=.7,e.preload="auto";const t=new(window.AudioContext||window.webkitAudioContext);scene.userData.audio=e,scene.userData.audioContext=t,e.addEventListener("error",e=>{console.error("音频加载错误:",e),document.getElementById("musicButton").innerText="音频加载失败",document.getElementById("musicButton").disabled=!0,scene.userData.audioLoaded=!1}),e.addEventListener("canplaythrough",()=>{console.log("音频加载完成"),scene.userData.audioLoaded=!0}),e.addEventListener("ended",()=>{musicPlaying=!1,document.getElementById("musicButton").innerText="播放音乐"}),document.getElementById("musicButton").addEventListener("click",async()=>{await startStopMusic()})}async function startStopMusic(){const e=scene.userData.audio,t=scene.userData.audioContext;if(e&&scene.userData.audioLoaded)try{t&&"suspended"===t.state&&await t.resume(),musicPlaying?(e.pause(),musicPlaying=!1,document.getElementById("musicButton").innerText="播放音乐"):(await e.play(),musicPlaying=!0,document.getElementById("musicButton").innerText="静音")}catch(e){console.error("音频播放失败:",e),alert("音频播放失败，请检查MP3文件URL是否可访问")}else console.error("音频未准备好")}function animate(e){requestAnimationFrame(animate),step=(step+1)%1e3,uniforms.time.value=e,uniforms.step.value=step,controls.update(),params.isDecorationsDancing&&scene.children.forEach(t=>{if(t.material&&t.material.uniforms&&t.material.uniforms.time&&150===t.geometry.attributes.position.count){const n=t.geometry.attributes.position.array;for(let t=0;t<n.length;t+=3)n[t]+=.02*Math.sin(.001*e+n[t+1]),n[t+2]+=.02*Math.cos(.001*e+n[t+1]);t.geometry.attributes.position.needsUpdate=!0}}),composer.render()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),composer.setSize(window.innerWidth,window.innerHeight)}function addTree(e,t,n,o,a=1){const r=new THREE.ShaderMaterial({uniforms:{pointTexture:{value:(new THREE.TextureLoader).load("https://assets.codepen.io/3685267/spark1.png")}},vertexShader:"\n    attribute float mIndex;\n    varying vec3 vColor;\n    varying float opacity;\n\n    float norm(float value, float min, float max ){\n        return (value - min) / (max - min);\n    }\n    float lerp(float norm, float min, float max){\n        return (max - min) * norm + min;\n    }\n    float map(float value, float sourceMin, float sourceMax, float destMin, float destMax){\n        return lerp(norm(value, sourceMin, sourceMax), destMin, destMax);\n    }\n    void main() {\n        vColor = color;\n        vec3 p = position;\n        vec4 mvPosition = modelViewMatrix * vec4( p, 1.0 );\n        opacity = map(mvPosition.z , -200.0, 15.0, 0.0, 1.0);\n        gl_PointSize = 4.0 * ( 100.0 / -mvPosition.z );\n        gl_Position = projectionMatrix * mvPosition;\n    }\n    ",fragmentShader:"\n    varying vec3 vColor;\n    varying float opacity;\n    uniform sampler2D pointTexture;\n    void main() {\n        gl_FragColor = vec4( vColor, opacity );\n        gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord ); \n    }\n    ",blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,vertexColors:!0}),s=new THREE.BufferGeometry,i=[],l=[],d=[],c=[],u=[],p=new THREE.Color;for(let e=0;e<n;e++){const t=Math.random(),o=map(t,0,1,-16*a,20*a),r=map(t,0,1,0,6*TAU)+TAU/2*(e%2);let s;if(t<.1)s=2*a;else{const e=(t-.1)/.9;s=map(Math.pow(e,.6),0,1,15*a,0)}const[m,f]=polar(r,s),g=t<.1?.2:map(t,.1,1,1.5,.5);i.push(f+rand(-.15*g,.15*g)*a,o+rand(-.1*g,.1*g)*a,m+rand(-.15*g,.15*g)*a);const h=map(e,0,n,0,1);if(h<.1?p.setHSL(0,0,.7):p.setHSL(0,0,.9),l.push(p.r,p.g,p.b),c.push(rand(1e3)),h<.1)d.push(2.5*a);else{const e=map(h,.1,1,2.2,1.6)*a;d.push(e*(1+rand(-.1,.1)))}const E=map(e,0,n,1,0);u.push(E)}s.setAttribute("position",new THREE.Float32BufferAttribute(i,3).setUsage(THREE.DynamicDrawUsage)),s.setAttribute("color",new THREE.Float32BufferAttribute(l,3)),s.setAttribute("size",new THREE.Float32BufferAttribute(d,1)),s.setAttribute("phase",new THREE.Float32BufferAttribute(c,1)),s.setAttribute("mIndex",new THREE.Float32BufferAttribute(u,1));const m=new THREE.Points(s,r),[f,g,h]=o;m.position.x=f,m.position.y=g,m.position.z=h,treePoints=m,e.add(m)}function addSnow(e,t,n){["https://assets.codepen.io/3685267/snowflake1.png","https://assets.codepen.io/3685267/snowflake2.png","https://assets.codepen.io/3685267/snowflake3.png","https://assets.codepen.io/3685267/snowflake4.png","https://assets.codepen.io/3685267/snowflake5.png","https://assets.codepen.io/3685267/snowflake1.png","https://assets.codepen.io/3685267/snowflake2.png","https://assets.codepen.io/3685267/snowflake3.png","https://assets.codepen.io/3685267/snowflake4.png"].forEach(n=>{!function(n){const o=new THREE.ShaderMaterial({uniforms:{...t,pointTexture:{value:(new THREE.TextureLoader).load(n)}},vertexShader:"\n    attribute float size;\n    attribute float phase;\n    attribute float phaseSecondary;\n    varying vec3 vColor;\n    varying float opacity;\n    uniform float time;\n    uniform float step;\n    float norm(float value, float min, float max ){\n        return (value - min) / (max - min);\n    }\n    float lerp(float norm, float min, float max){\n        return (max - min) * norm + min;\n    }\n    float map(float value, float sourceMin, float sourceMax, float destMin, float destMax){\n        return lerp(norm(value, sourceMin, sourceMax), destMin, destMax);\n    }\n\n    float random(float x) {\n        return fract(sin(x) * 43758.5453);\n    }\n    void main() {\n        float t = time * 0.0006;\n        vColor = color;\n        vec3 p = position;\n\n        float yOffset = mod(phase + step, 1000.0);\n        p.y = map(yOffset, 0.0, 1000.0, 25.0, -8.0);\n\n        float xOffset = sin(t + phase) * (random(phase) * 2.0 + 0.5);\n        float zOffset = cos(t + phaseSecondary) * (random(phaseSecondary) * 2.0 + 0.5);\n\n        float rot = t * random(phase + phaseSecondary);\n        p.x += xOffset + sin(rot) * random(phase);\n        p.z += zOffset + cos(rot) * random(phaseSecondary);\n\n        opacity = map(p.z, -150.0, 15.0, 0.0, 1.0);\n        vec4 mvPosition = modelViewMatrix * vec4(p, 1.0);\n        gl_PointSize = size * (100.0 / -mvPosition.z);\n        gl_Position = projectionMatrix * mvPosition;\n    }\n    ",fragmentShader:"\n      uniform sampler2D pointTexture;\n      varying vec3 vColor;\n      varying float opacity;\n      void main() {\n       gl_FragColor = vec4( vColor, opacity );\n       gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord ); \n      }\n      ",blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,vertexColors:!0}),a=new THREE.BufferGeometry,r=[],s=[],i=[],l=[],d=[],c=new THREE.Color;for(let e=0;e<600;e++){const[e,t,n]=[rand(100,-100),0,rand(80,-400)];r.push(e),r.push(t),r.push(n),Math.random()>.75?(c.set(randChoise(["#ffffff","#ffffff","#fafaff"])),i.push(rand(6,4))):Math.random()>.5?(c.set(randChoise(["#ffffff","#f8f8ff"])),i.push(rand(4,2.5))):(c.set(randChoise(["#f1f6f9","#eeeeee","#e8e8e8"])),i.push(rand(2.5,1.5))),s.push(c.r,c.g,c.b),l.push(rand(1e3)),d.push(rand(1e3))}a.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),a.setAttribute("color",new THREE.Float32BufferAttribute(s,3)),a.setAttribute("size",new THREE.Float32BufferAttribute(i,1)),a.setAttribute("phase",new THREE.Float32BufferAttribute(l,1)),a.setAttribute("phaseSecondary",new THREE.Float32BufferAttribute(d,1));const u=new THREE.Points(a,o);e.add(u)}(n)})}function addPlane(e,t,n){const o=new THREE.ShaderMaterial({uniforms:{...t,pointTexture:{value:(new THREE.TextureLoader).load("https://assets.codepen.io/3685267/spark1.png")}},vertexShader:"\n        attribute float size;\n        attribute vec3 customColor;\n        varying vec3 vColor;\n\n        void main() {\n            vColor = customColor;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_PointSize = size * (300.0 / -mvPosition.z);\n            gl_Position = projectionMatrix * mvPosition;\n        }\n    ",fragmentShader:"\n        uniform vec3 color;\n        uniform sampler2D pointTexture;\n        varying vec3 vColor;\n        void main() {\n            gl_FragColor = vec4(vColor, 1.0);\n            gl_FragColor = gl_FragColor * texture2D(pointTexture, gl_PointCoord);\n        }\n    ",blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,vertexColors:!0}),a=new THREE.BufferGeometry,r=[],s=[],i=[],l=new THREE.Color;for(let e=0;e<n;e++){const e=rand(0,TAU),t=Math.sqrt(rand(0,2500)),[n,o]=polar(e,t);r.push(n),r.push(0),r.push(o);const a=Math.sqrt(n*n+o*o);if(a<25)l.set(randChoise(["#ffffff","#fafaff","#f8f8ff"])),i.push(rand(2.2,1.6));else{const e=map(a,25,50,.95,.85);l.setHSL(0,0,e),i.push(rand(1.6,.9))}s.push(l.r,l.g,l.b)}a.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),a.setAttribute("customColor",new THREE.Float32BufferAttribute(s,3)),a.setAttribute("size",new THREE.Float32BufferAttribute(i,1));const d=new THREE.Points(a,o);d.position.y=-16,groundPoints=d,e.add(d)}function addDecorations(e,t,n){const o=new THREE.ShaderMaterial({uniforms:{...t,pointTexture:{value:(new THREE.TextureLoader).load("https://assets.codepen.io/3685267/spark1.png")}},vertexShader:"\n                attribute float size;\n                varying vec3 vColor;\n                varying float opacity;\n                uniform float time;\n\n                void main() {\n                    vColor = color;\n                    vec3 p = position;\n                    vec4 mvPosition = modelViewMatrix * vec4(p, 1.0);\n                    opacity = 0.7;\n                    float scale = 0.8 + sin(time * 0.001 + position.x) * 0.2;\n                    gl_PointSize = size * scale * (100.0 / -mvPosition.z);\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            ",fragmentShader:"\n                varying vec3 vColor;\n                varying float opacity;\n                uniform sampler2D pointTexture;\n                void main() {\n                    gl_FragColor = vec4(vColor, opacity);\n                    gl_FragColor = gl_FragColor * texture2D(pointTexture, gl_PointCoord);\n                }\n            ",blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,vertexColors:!0}),a=new THREE.BufferGeometry,r=[],s=[],i=[],l=new THREE.Color;for(let e=0;e<150;e++){const t=e/150*TAU,n=15+rand(-5,5),o=rand(-12,22),[a,d]=polar(t,n);if(r.push(a,o,d),Math.random()>.7){const e=rand(.1,.15),t=rand(.7,.9),n=rand(.6,.8);l.setHSL(e,t,n)}else if(Math.random()>.4){const e=rand(.95,1),t=rand(.7,.9),n=rand(.5,.7);l.setHSL(e,t,n)}else{const e=rand(.8,.95);l.setHSL(0,0,e)}s.push(l.r,l.g,l.b),i.push(rand(2.5,4.5))}a.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),a.setAttribute("color",new THREE.Float32BufferAttribute(s,3)),a.setAttribute("size",new THREE.Float32BufferAttribute(i,1));const d=new THREE.Points(a,o);e.add(d)}document.addEventListener("keydown",e=>{if("KeyA"===e.code&&(composer.passes[1].strength=3,composer.passes[1].threshold=0),"KeyS"===e.code){const e=!scene.userData.isSnowBig;scene.userData.isSnowBig=e,scene.children.forEach(t=>{if(t.material&&t.material.uniforms&&t.material.uniforms.time&&t.geometry.attributes.size){const n=t.geometry.attributes.size.array;for(let t=0;t<n.length;t++)n[t]=e?2*n[t]:n[t]/2;t.geometry.attributes.size.needsUpdate=!0}})}}),document.addEventListener("keyup",e=>{"KeyA"===e.code&&(composer.passes[1].strength=params.bloomStrength,composer.passes[1].threshold=params.bloomThreshold)}),init(),animate(),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".subtitle");if(!e)return;document.addEventListener("mousemove",t=>{const n=e.getBoundingClientRect(),o=n.left+n.width/2,a=n.top+n.height/2,r=Math.hypot(t.clientX-o,t.clientY-a);if(r<150){const n=Math.atan2(a-t.clientY,o-t.clientX),s=(150-r)/150,i=Math.cos(n)*s*60,l=Math.sin(n)*s*60;e.style.transform=`translate(${i}px, ${l}px)`,e.style.transition="transform 0.2s ease-out"}else e.style.transform="none",e.style.transition="transform 0.5s ease-out"})})</script><div class="message"><h1>Merry Christmas</h1><p>--To:聂紫莹</p></div><div class="subtitle"><p>Aurorp1g</p></div></body></html>